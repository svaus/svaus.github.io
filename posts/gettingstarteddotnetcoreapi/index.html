<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Sample DotNet Core Api with Serilog, Autofac, Swagger" />
<meta property="og:description" content="Sample DotNet Core Api project with :
 Serilog implementation with various sinks console, file, application insigths Autofac Swagger with ReDoc and Material Design  Tools used  VS Code Aspnet Core 2.2 SDK Azure (For Application Insights only)  dotnet new webapi Add Serilog Logging to project Add below packages to solution/project
dotnet add package Serilog.AspNetCore dotnet add package Serilog.Sinks.Console dotnet add package Serilog.Settings.Configuration Modify the Program.cs file as below." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://svaus.github.io/posts/gettingstarteddotnetcoreapi/" />
<meta property="article:published_time" content="2020-05-10T13:06:28+10:00" />
<meta property="article:modified_time" content="2020-05-10T13:06:28+10:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Sample DotNet Core Api with Serilog, Autofac, Swagger"/>
<meta name="twitter:description" content="Sample DotNet Core Api project with :
 Serilog implementation with various sinks console, file, application insigths Autofac Swagger with ReDoc and Material Design  Tools used  VS Code Aspnet Core 2.2 SDK Azure (For Application Insights only)  dotnet new webapi Add Serilog Logging to project Add below packages to solution/project
dotnet add package Serilog.AspNetCore dotnet add package Serilog.Sinks.Console dotnet add package Serilog.Settings.Configuration Modify the Program.cs file as below."/>


    <meta name="description" content="">
    <link rel="canonical" href="https://svaus.github.io/posts/gettingstarteddotnetcoreapi/">

    
    <title>Sample DotNet Core Api with Serilog, Autofac, Swagger &middot; Go Code</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://svaus.github.io/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      



<nav class="white" role="navigation">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1">
            
            <a href="#" data-target="nav-mobile" class="sidenav-trigger black-text">
                <i class="material-icons">menu</i>
            </a>

            
            <ul id="nav-mobile" class="sidenav">
                
                
    
    

            </ul>

            
            <a href="/" class="brand-logo grey-text text-darken-3">Go Code</a>

            
            <div class="nav-wrapper">

                
                <ul class="right hide-on-med-and-down">
                    
                    
    
    

                </ul>

            </div>
        </div>
    </div>
</nav>
    

    

<article class="max-width">
    
    <section class="row">
        <div class="col s12 m10 offset-m1 l10 offset-l1">
            <h1>Sample DotNet Core Api with Serilog, Autofac, Swagger</h1>
        </div>
    </section>

    
    

    
    <section class="row">
        <div class="col s12 m8 offset-m2 l2 offset-l1">
            

<p class="article-meta">
    <div class="article-meta-container">
        <div class="article-meta-author-name"></div>
        <div class="article-meta-description"></div>
    </div>
    <span class="article-meta-published-at grey-text text-darken-1">May 10, 2020</span>
</p>
        </div>
        <div class="col s12 m8 offset-m2 l6">
            <p>Sample DotNet Core Api project with :</p>
<ul>
<li>Serilog implementation with various sinks console, file, application insigths</li>
<li>Autofac</li>
<li>Swagger with ReDoc and Material Design</li>
</ul>
<h2 id="tools-used">Tools used</h2>
<ul>
<li>VS Code</li>
<li>Aspnet Core 2.2 SDK</li>
<li>Azure (For Application Insights only)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dotnet new webapi
</code></pre></div><h2 id="add-serilog-logging-to-project">Add Serilog Logging to project</h2>
<p>Add below packages to solution/project</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dotnet add package Serilog.AspNetCore
dotnet add package Serilog.Sinks.Console
dotnet add package Serilog.Settings.Configuration
</code></pre></div><p>Modify the Program.cs file as below. Added method UseSerilog which is injecting log configuration from configuration file i.e. appsettings.json</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IWebHostBuilder CreateWebHostBuilder(<span style="color:#66d9ef">string</span>[] args) =&gt;
            WebHost.CreateDefaultBuilder(args)
                .UseStartup&lt;Startup&gt;()
                .UseSerilog((hostingContext, loggerConfiguration) =&gt; {
                    loggerConfiguration
                    .ReadFrom
                    .Configuration(hostingContext.Configuration)
                    .Enrich.FromLogContext()
                    .WriteTo.Console();
                });
</code></pre></div><p>Now add the below section in appsettings.json file at root level of appsetting json :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#e6db74">&#34;Serilog&#34;</span>: {
      <span style="color:#e6db74">&#34;Using&#34;</span>: [ <span style="color:#e6db74">&#34;Serilog.Sinks.Console&#34;</span> ],
      <span style="color:#e6db74">&#34;MinimumLevel&#34;</span>: <span style="color:#e6db74">&#34;Debug&#34;</span>,
      <span style="color:#e6db74">&#34;WriteTo&#34;</span>: [
        { <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Console&#34;</span> }        
      ],
      <span style="color:#e6db74">&#34;Enrich&#34;</span>: [ <span style="color:#e6db74">&#34;FromLogContext&#34;</span>, <span style="color:#e6db74">&#34;WithMachineName&#34;</span>, <span style="color:#e6db74">&#34;WithThreadId&#34;</span> ],
      <span style="color:#e6db74">&#34;Properties&#34;</span>: {
      <span style="color:#e6db74">&#34;Application&#34;</span>: <span style="color:#e6db74">&#34;SampleDotNetCoreApi&#34;</span>
      }
    }
</code></pre></div><p>In configure method of Startup.cs class add below code in the beginning and also inject ILoggerFactory. This ILoggerFactory is injected by AspNetCore dependency injection.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">loggerFactory.AddSerilog();
</code></pre></div><h3 id="add-logging-to-rolling-file-using-serilog">Add logging to Rolling File using Serilog</h3>
<p>If you want to do logging to file, Serilog provides sink for RollingFile.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dotnet add package Serilog.Sinks.RollingFile
</code></pre></div><p>And to appsettings.json file add the section for RollingFile. There is no code required for this. Serilog will read the configuration and apply the settings. The only thing which is required is adding the package.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#e6db74">&#34;WriteTo&#34;</span>: [
        { <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Console&#34;</span> },
        {
        <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;RollingFile&#34;</span>,
          <span style="color:#e6db74">&#34;Args&#34;</span>: {
          <span style="color:#e6db74">&#34;pathFormat&#34;</span>: <span style="color:#e6db74">&#34;logs\\log-{Date}.txt&#34;</span>,
          <span style="color:#e6db74">&#34;outputTemplate&#34;</span>: <span style="color:#e6db74">&#34;{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level}] {Message}{NewLine}{Exception}&#34;</span>
          }
        }
      ],
</code></pre></div><h3 id="adding-application-insight-to-serilog">Adding Application insight to Serilog</h3>
<p>Adding application insights with Serilog is just two steps as below :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dotnet add package Serilog.Sinks.ApplicationInsights
</code></pre></div><p>Also add the below configuration in appsettings.json. Change the instrumentation key.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#e6db74">&#34;WriteTo&#34;</span>: [
        { <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Console&#34;</span> },
        {
        <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;RollingFile&#34;</span>,
          <span style="color:#e6db74">&#34;Args&#34;</span>: {
          <span style="color:#e6db74">&#34;pathFormat&#34;</span>: <span style="color:#e6db74">&#34;logs\\log-{Date}.txt&#34;</span>,
          <span style="color:#e6db74">&#34;outputTemplate&#34;</span>: <span style="color:#e6db74">&#34;{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level}] {Message}{NewLine}{Exception}&#34;</span>
          }
        },
        {
          <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;ApplicationInsights&#34;</span>,
          <span style="color:#e6db74">&#34;Args&#34;</span>: {
            <span style="color:#e6db74">&#34;instrumentationKey&#34;</span>: <span style="color:#e6db74">&#34;KEY&#34;</span>,
            <span style="color:#e6db74">&#34;telemetryConverter&#34;</span>: <span style="color:#e6db74">&#34;Serilog.Sinks.ApplicationInsights.Sinks.ApplicationInsights.TelemetryConverters.TraceTelemetryConverter, Serilog.Sinks.ApplicationInsights&#34;</span>
          }
        }
      ],

</code></pre></div><h3 id="prefix-for-development-apm">Prefix for Development APM</h3>
<p>Prefix is a free tool provided for development environment monitoring. Download the tool from below location</p>
<p><a href="https://stackify.com/prefix-download/">Prefix Download</a></p>
<p>Once downloaded install the tool in the development machine.</p>
<h3 id="why-add-autofac">Why add Autofac</h3>
<p>Aspnet Core comes up with default dependency injection hence third party dependency injection is not required. However, default dependency injection doesn&rsquo;t have full functionality as offered by other DI libraries. Autofac is another DI library with lot of features built into it.</p>
<h3 id="add-autofac">Add Autofac</h3>
<p>Insatall the package using below command. I am going to use without configure container method as usually in complex project we would need a lot of customisation and without configure container works in that scenario.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">
dotnet add package Autofac.Extensions.DependencyInjection
</code></pre></div><p>For more details about Autofac check the documentation here -&gt; <a href="https://autofaccn.readthedocs.io/en/latest/integration/aspnetcore.html">Autofac</a></p>
<p>Add a public property in the Startup.cs</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">public</span> IContainer ApplicationContainer { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">set</span>; }
</code></pre></div><p>and add the below lines of code in ConfigureServices method and change the return type from void to IServiceProvider which will be replaced by new AutofacServiceProvider. This registers all the dependencies in that service to Autofac :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">            <span style="color:#66d9ef">var</span> builder = <span style="color:#66d9ef">new</span> ContainerBuilder();

            builder.Populate(services);

            <span style="color:#66d9ef">this</span>.ApplicationContainer = builder.Build();

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> AutofacServiceProvider(ApplicationContainer);

</code></pre></div><h3 id="add-swaggerswashbuckle-to-api-for-documentation">Add Swagger/Swashbuckle to API for documentation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dotnet add package Swashbuckle.AspNetCore
</code></pre></div><p>Add the below lines of code in <code>ConfigureService</code> method</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">            services.AddSwaggerGen(c =&gt;
            {
                c.SwaggerDoc(<span style="color:#e6db74">&#34;v1&#34;</span>, <span style="color:#66d9ef">new</span> Info{
                   Title = <span style="color:#e6db74">&#34;Sample DotNet Core Api&#34;</span>,
                   Version = <span style="color:#e6db74">&#34;v1&#34;</span>
                });
            });
</code></pre></div><p>Add below lines in Configure method :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">            app.UseSwagger();

            app.UseSwaggerUI(c=&gt; {
                c.SwaggerEndpoint(<span style="color:#e6db74">&#34;/swagger/v1/swagger.json&#34;</span>, <span style="color:#e6db74">&#34;Sample DotNet Api V1&#34;</span>);
                c.RoutePrefix = <span style="color:#66d9ef">string</span>.Empty;
            });
</code></pre></div><h3 id="adding-redoc-for-swagger-for-different-ui-theme">Adding ReDoc for swagger for different UI theme</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">dotnet add package Swashbuckle.AspNetCore.ReDoc
</code></pre></div><p>Add below code and comment out UseSwaggerUI piece of code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">            <span style="color:#75715e">// app.UseSwaggerUI(c=&gt; {                
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//     c.SwaggerEndpoint(&#34;/swagger/v1/swagger.json&#34;, &#34;Sample DotNet Api V1&#34;);
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//     c.RoutePrefix = string.Empty;
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//     c.InjectStylesheet(&#34;/swagger-ui/custom.css&#34;);
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// });
</span><span style="color:#75715e"></span>
            app.UseReDoc(c =&gt; {
                c.SpecUrl = <span style="color:#e6db74">&#34;/swagger/v1/swagger.json&#34;</span>;
                c.DocumentTitle = <span style="color:#e6db74">&#34;Sample DotNet Core Api V1&#34;</span>;
            });

</code></pre></div><p><img src="%22https://github.com/svaus/SampleDotNetCoreApi/blob/master/ReDocUI.PNG%22" alt="ReDocUI"></p>
<h3 id="add-another-custom-style">Add another custom style</h3>
<p>Updated the custom.css for material design UI</p>
<p><img src="%22https://github.com/svaus/SampleDotNetCoreApi/blob/master/SwaggerWithStyleChanges.PNG%22" alt="SwaggerMaterialUI"></p>

        </div>
    </section>
</article>



    
      <footer class="page-footer grey lighten-5">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1 clear-padding">
            <div class="row">
    
        
    

    
    
    <div class="col s12 l12">
        <h5 class="black-text">Have fun with coding</h5>
<p class="grey-text text-darken-4">Look for posts on dotnet, azure, devops blogs.</p>
    </div>

    
</div>


        </div>
    </div>
    <div class="footer-copyright">
        <div class="row max-width" style="width: 100%;">
            <div class="col s12 l10 offset-l1">
                <span class="grey-text text-darken-4">Â© 2020.</span>
<div class="right">
    
</div>
            </div>
        </div>
    </div>
</footer>
    

    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://svaus.github.io/js/script.js"></script>
  </body>
</html>